#!/usr/bin/env bash

FILE="/tmp/color.txt"
if [[ ! -a $FILE ]]; then
  touch $FILE
fi
mode=$( < $FILE )

dark() {
  if [[ $mode != "dark" ]]; then
    echo "dark" > $FILE
    gsettings set org.gnome.desktop.interface color-scheme prefer-dark
    gsettings set org.gnome.desktop.interface gtk-theme Gruvbox-Dark-BL
    kitty +kitten themes --reload-in=all Gruvbox Dark
    notify-send -t 2000 "Dark mode enabled"
  else
    echo "Nothing to do"
  fi
}

light() {
  if [[ $mode != "light" ]]; then
    echo "light" > $FILE
    gsettings set org.gnome.desktop.interface gtk-theme Gruvbox-Light
    gsettings set org.gnome.desktop.interface color-scheme prefer-light
    #kitty +kitten themes --reload-in=all Gruvbox Light Hard
    notify-send -t 2000 "Light mode enabled"
  else
    echo "Nothing to do"
  fi
}

case "$1" in
  dark ) dark && exit 0 ;;
  light ) light && exit 0 ;;
  period-changed) # gammastep hook
    case "$3" in
      night) dark ;;
      daytime) light ;;
    esac
    ;;
  auto ) # update the theme automatically
    DAWN=05
    SUNSET=20
    now=$(date +%H)

    if [[ ${now#0} -gt $DAWN && ${now#0} -lt $SUNSET ]]; then
      light
    else
      dark
    fi
    exit 0
    ;;
  * )
    echo $mode
    ;;
esac
